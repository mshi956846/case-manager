generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  firmName  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Contact {
  id        String      @id @default(cuid())
  name      String
  email     String?
  phone     String?
  address   String?
  type      ContactType @default(CLIENT)
  company   String?
  notes     String?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  matters      MatterContact[]
  invoices     Invoice[]
  transactions Transaction[]
}

enum ContactType {
  CLIENT
  OPPOSING_PARTY
  WITNESS
  JUDGE
  OTHER
}

model Matter {
  id                   String       @id @default(cuid())
  title                String
  caseNumber           String?      @unique
  status               MatterStatus @default(OPEN)
  practiceArea         String?
  description          String?
  openDate             DateTime     @default(now())
  closeDate            DateTime?
  statuteOfLimitations DateTime?
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt

  contacts     MatterContact[]
  tasks        Task[]
  timeEntries  TimeEntry[]
  documents    Document[]
  invoices     Invoice[]
  events       CalendarEvent[]
  transactions Transaction[]
  filings      Filing[]
}

enum MatterStatus {
  OPEN
  PENDING
  CLOSED
}

model MatterContact {
  id        String            @id @default(cuid())
  role      MatterContactRole @default(CLIENT)
  matterId  String
  contactId String
  matter    Matter            @relation(fields: [matterId], references: [id], onDelete: Cascade)
  contact   Contact           @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@unique([matterId, contactId])
}

enum MatterContactRole {
  CLIENT
  OPPOSING_PARTY
  WITNESS
  JUDGE
  EXPERT
  OTHER
}

model Task {
  id          String     @id @default(cuid())
  title       String
  description String?
  dueDate     DateTime?
  priority    Priority   @default(MEDIUM)
  status      TaskStatus @default(TODO)
  matterId    String?
  matter      Matter?    @relation(fields: [matterId], references: [id], onDelete: SetNull)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  DONE
}

model CalendarEvent {
  id          String    @id @default(cuid())
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime?
  allDay      Boolean   @default(false)
  type        EventType @default(MEETING)
  matterId    String?
  matter      Matter?   @relation(fields: [matterId], references: [id], onDelete: SetNull)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

enum EventType {
  HEARING
  DEADLINE
  MEETING
  REMINDER
}

model TimeEntry {
  id              String   @id @default(cuid())
  description     String
  date            DateTime
  durationMinutes Int
  hourlyRate      Float    @default(0)
  billable        Boolean  @default(true)
  matterId        String?
  matter          Matter?  @relation(fields: [matterId], references: [id], onDelete: SetNull)
  invoiceId       String?
  invoice         Invoice? @relation(fields: [invoiceId], references: [id], onDelete: SetNull)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Invoice {
  id            String        @id @default(cuid())
  invoiceNumber String        @unique
  status        InvoiceStatus @default(DRAFT)
  issueDate     DateTime      @default(now())
  dueDate       DateTime?
  subtotal      Float         @default(0)
  tax           Float         @default(0)
  total         Float         @default(0)
  notes         String?
  contactId     String?
  contact       Contact?      @relation(fields: [contactId], references: [id], onDelete: SetNull)
  matterId             String?
  matter               Matter?          @relation(fields: [matterId], references: [id], onDelete: SetNull)
  billingType          BillingType      @default(HOURLY)
  offenseType          String?
  flatFeeStructure     FlatFeeStructure?
  flatFeeAmount        Float?
  splitUpfrontPercent  Float?
  splitRemainderEvent  SplitFeeEvent?
  hourlyRateType       HourlyRateType?
  hourlyRate           Float?
  includesTrial        Boolean?
  trialDays            Int?
  trialFeeType         TrialFeeType?
  trialFeeAmount       Float?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt

  lineItems    InvoiceLineItem[]
  timeEntries  TimeEntry[]
  transactions Transaction[]
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
}

enum BillingType {
  HOURLY
  FLAT_FEE
}

enum FlatFeeStructure {
  FULL_UP_FRONT
  SPLIT
}

enum SplitFeeEvent {
  FIRST_PRE_TRIAL
  FINAL_PRE_TRIAL
  PLEA_HEARING
  SENTENCING
  MOTION_HEARING
  BENCH_TRIAL
  JURY_TRIAL
}

enum TrialFeeType {
  DAILY_RATE
  FLAT
}

enum HourlyRateType {
  INVOICE_RATE
  PER_ENTRY
}

model InvoiceLineItem {
  id          String  @id @default(cuid())
  description String
  quantity    Float   @default(1)
  rate        Float
  amount      Float
  invoiceId   String
  invoice     Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  timeEntryId String?
}

enum DocumentType {
  UPLOADED
  WORD_PROCESSOR
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum PaymentMethod {
  CASH
  CHECK
  CREDIT_CARD
  DEBIT_CARD
  BANK_TRANSFER
  WIRE
  MONEY_ORDER
  IOLTA
  OTHER
}

model AccountCategory {
  id          String          @id @default(cuid())
  name        String          @unique
  code        String          @unique
  type        TransactionType
  description String?
  taxLine     String?
  isSystem    Boolean         @default(false)
  sortOrder   Int             @default(0)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  transactions Transaction[]
}

model Transaction {
  id              String          @id @default(cuid())
  type            TransactionType
  date            DateTime
  amount          Float
  description     String
  payee           String?
  referenceNumber String?
  paymentMethod   PaymentMethod?
  notes           String?
  isReimbursable  Boolean         @default(false)
  categoryId      String
  category        AccountCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  matterId        String?
  matter          Matter?         @relation(fields: [matterId], references: [id], onDelete: SetNull)
  contactId       String?
  contact         Contact?        @relation(fields: [contactId], references: [id], onDelete: SetNull)
  invoiceId       String?
  invoice         Invoice?        @relation(fields: [invoiceId], references: [id], onDelete: SetNull)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model Document {
  id           String       @id @default(cuid())
  name         String
  filePath     String?
  mimeType     String?
  sizeBytes    Int?
  documentType DocumentType @default(UPLOADED)
  content      Json?
  matterId     String?
  matter       Matter?      @relation(fields: [matterId], references: [id], onDelete: SetNull)
  uploadedAt   DateTime     @default(now())
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  filingDocuments FilingDocument[]
}

// ─── E-Filing ─────────────────────────────────────────────

enum FilingStatus {
  DRAFT
  READY
  SUBMITTED
  ACCEPTED
  REJECTED
  RETURNED
}

enum FilingType {
  INITIAL
  SUBSEQUENT
  SERVICE_ONLY
}

enum ServiceMethod {
  E_SERVICE
  MAIL
  PERSONAL
  PUBLICATION
}

enum ServiceStatus {
  PENDING
  SERVED
  FAILED
}

enum FilingDocumentRole {
  LEAD
  ATTACHMENT
  PROPOSED_ORDER
}

model Filing {
  id           String       @id @default(cuid())
  status       FilingStatus @default(DRAFT)
  filingType   FilingType   @default(SUBSEQUENT)
  county       String
  court        String
  division     String?
  judge        String?
  causeNumber  String?
  filingParty  String
  envelopeNumber String?
  filingCode   String?
  feeAmount    Float        @default(0)
  feeWaived    Boolean      @default(false)
  notes        String?
  submittedAt  DateTime?
  acceptedAt   DateTime?
  rejectedAt   DateTime?
  rejectionReason String?
  returnReason    String?
  matterId     String?
  matter       Matter?      @relation(fields: [matterId], references: [id], onDelete: SetNull)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  documents    FilingDocument[]
  serviceRecords ServiceRecord[]
}

model FilingDocument {
  id         String             @id @default(cuid())
  role       FilingDocumentRole @default(LEAD)
  filingCode String?
  sortOrder  Int                @default(0)
  filingId   String
  filing     Filing             @relation(fields: [filingId], references: [id], onDelete: Cascade)
  documentId String
  document   Document           @relation(fields: [documentId], references: [id], onDelete: Cascade)
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt

  @@unique([filingId, documentId])
}

model ServiceRecord {
  id           String        @id @default(cuid())
  method       ServiceMethod @default(E_SERVICE)
  status       ServiceStatus @default(PENDING)
  partyName    String
  partyEmail   String?
  partyAddress String?
  partyRole    String?
  serviceDate  DateTime?
  filingId     String
  filing       Filing        @relation(fields: [filingId], references: [id], onDelete: Cascade)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

// ─── Court Intelligence ─────────────────────────────────────

enum CourtType {
  SUPERIOR
  CIRCUIT
}

enum MotionType {
  SUPPRESS_EVIDENCE
  SUPPRESS_STATEMENT
  SUPPRESS_IDENTIFICATION
  DISMISS
  CHANGE_OF_VENUE
  CONTINUANCE
  BOND_REDUCTION
  COMPEL_DISCOVERY
  LIMINE
  RECONSIDER
  OTHER
}

enum MotionResult {
  GRANTED
  DENIED
  PARTIALLY_GRANTED
  WITHDRAWN
  MOOT
}

enum OffenseLevel {
  MURDER
  LEVEL_1_FELONY
  LEVEL_2_FELONY
  LEVEL_3_FELONY
  LEVEL_4_FELONY
  LEVEL_5_FELONY
  LEVEL_6_FELONY
  CLASS_A_MISDEMEANOR
  CLASS_B_MISDEMEANOR
  CLASS_C_MISDEMEANOR
  INFRACTION
}

enum OffenseCategory {
  DRUG_DEALING
  DRUG_POSSESSION
  DUI_OWI
  BATTERY
  DOMESTIC_BATTERY
  ASSAULT
  ROBBERY
  BURGLARY
  THEFT
  FRAUD
  WEAPONS
  SEX_OFFENSE
  MURDER_HOMICIDE
  ARSON
  RESISTING
  DRIVING_OFFENSE
  OTHER
}

enum CaseDisposition {
  PLEA_AGREEMENT
  PLEA_OPEN
  BENCH_TRIAL_CONVICTION
  BENCH_TRIAL_ACQUITTAL
  JURY_TRIAL_CONVICTION
  JURY_TRIAL_ACQUITTAL
  DISMISSED
  DIVERTED
  OTHER
}

model Judge {
  id            String    @id @default(cuid())
  name          String
  county        String
  courtType     CourtType
  courtNumber   Int?
  division      String?
  appointedDate DateTime?
  isActive      Boolean   @default(true)
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  motionOutcomes    MotionOutcome[]
  sentencingRecords SentencingRecord[]

  @@unique([name, county])
}

model Prosecutor {
  id        String   @id @default(cuid())
  name      String
  office    String
  county    String
  title     String?
  isActive  Boolean  @default(true)
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sentencingRecords      SentencingRecord[]
  prosecutorCaseOutcomes ProsecutorCaseOutcome[]

  @@unique([name, county])
}

model MotionOutcome {
  id              String           @id @default(cuid())
  motionType      MotionType
  result          MotionResult
  judgeId         String
  judge           Judge            @relation(fields: [judgeId], references: [id], onDelete: Cascade)
  offenseCategory OffenseCategory?
  offenseLevel    OffenseLevel?
  caseNumber      String?
  filingDate      DateTime
  rulingDate      DateTime?
  notes           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model SentencingRecord {
  id                          String          @id @default(cuid())
  judgeId                     String
  judge                       Judge           @relation(fields: [judgeId], references: [id], onDelete: Cascade)
  prosecutorId                String?
  prosecutor                  Prosecutor?     @relation(fields: [prosecutorId], references: [id], onDelete: SetNull)
  offenseCategory             OffenseCategory
  offenseLevel                OffenseLevel
  offenseDescription          String?
  disposition                 CaseDisposition
  sentenceMonthsPrison        Int?
  sentenceMonthsSuspended     Int?
  sentenceMonthsProbation     Int?
  sentenceMonthsHomeDetention Int?
  fineAmount                  Float?
  communityServiceHours       Int?
  isConsecutive               Boolean         @default(false)
  restitutionAmount           Float?
  sentenceDate                DateTime
  caseNumber                  String?
  notes                       String?
  createdAt                   DateTime        @default(now())
  updatedAt                   DateTime        @updatedAt
}

model ProsecutorCaseOutcome {
  id              String          @id @default(cuid())
  prosecutorId    String
  prosecutor      Prosecutor      @relation(fields: [prosecutorId], references: [id], onDelete: Cascade)
  offenseCategory OffenseCategory
  offenseLevel    OffenseLevel
  disposition     CaseDisposition
  originalCharge  String?
  finalCharge     String?
  chargeReduced   Boolean         @default(false)
  outcomeDate     DateTime
  caseNumber      String?
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

// ─── Appellate Opinions ─────────────────────────────────────

enum AppellateCourt {
  SUPREME_COURT
  COURT_OF_APPEALS
}

enum AppellateOutcome {
  AFFIRMED
  REVERSED
  REVERSED_AND_REMANDED
  REMANDED
  VACATED
  DISMISSED
  TRANSFER_DENIED
  TRANSFER_GRANTED
  OTHER
}

model AppellateOpinion {
  id              String            @id @default(cuid())
  courtListenerId Int               @unique
  court           AppellateCourt
  caseName        String
  docketNumber    String            @unique
  dateFiled       DateTime
  authors         String
  panel           String
  outcome         AppellateOutcome  @default(OTHER)
  summary         String?
  pdfUrl          String?
  sourceUrl       String
  county          String?
  offenseCategory OffenseCategory?
  citeCount       Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
}
